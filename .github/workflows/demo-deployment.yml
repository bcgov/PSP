
name: Demo - Application deployment

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'lalala'
        default: 'fii'
        required: true

env:
  MY_PROD_SECRET: ${{ secrets.LE_SECRET }}                   # set this to your preferred AWS region, e.g. us-west-1


permissions:
  contents: read

jobs:
  build-api:
    name: Build Backend app
    runs-on: ubuntu-latest

    steps:
    - name: build pims-api
      run: echo "Building app"
    - name: store image
      run: echo "storing app image"

  build-frontend:
    name: Build Frontend
    runs-on: ubuntu-latest

    steps:
    - name: Build Frontend app
      run: echo "bBuilding frontendapp"
    - name: TEST Secrety
      run: echo "storing frontend image"

  deploy-dev-gate:
    name: Dev approval
    runs-on: ubuntu-latest
    environment: dev
    steps:
    - name: store image
      run: echo "Approval for deployment to DEV"
    needs: [build-api, build-frontend]

  deploy-dev:
    name: Dev deploy
    uses: ./.github/workflows/demo-db-deploy.yml
    with:
      domain: dev
    needs: [deploy-dev-gate]

  deploy-test-gate:
    name: Test approval
    runs-on: ubuntu-latest
    environment: test
    steps:
    - name: approval
      run: echo "Approval for deployment to TEST"
    needs: [deploy-dev]

  deploy-test:
    name: Test deploy
    uses: ./.github/workflows/demo-db-deploy.yml
    with:
      domain: test
    needs: [deploy-test-gate]

  deploy-uat-gate:
    name: UAT approval
    runs-on: ubuntu-latest
    environment: uat
    steps:
    - name: approval
      run: echo "Approval for deployment to UAT"
    needs: [deploy-test]

  deploy-uat:
    name: UAT deploy
    uses: ./.github/workflows/demo-db-deploy.yml
    with:
      domain: uat
    needs: [deploy-uat-gate]

  deploy-prod-gate:
    name: Production approval
    runs-on: ubuntu-latest
    environment: prod
    steps:
    - name: approval
      run: echo "Approval for deployment to PRODUCTION"
    needs: [deploy-uat]

  deploy-prod:
    name: Production deploy
    uses: ./.github/workflows/demo-db-deploy.yml
    with:
      domain: prod
    needs: [deploy-prod-gate]
