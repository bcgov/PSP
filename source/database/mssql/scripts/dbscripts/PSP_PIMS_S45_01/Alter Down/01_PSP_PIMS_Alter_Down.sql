-- Script generated by Aqua Data Studio Schema Synchronization for MS SQL Server 2016 on Fri Jan 13 12:19:15 PST 2023
-- Execute this script on:
-- 		PSP_PIMS_S45_01/dbo - This database/schema will be modified
-- to synchronize it with MS SQL Server 2016:
-- 		PSP_PIMS_S45_00/dbo

-- We recommend backing up the database prior to executing the script.

SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
GO
BEGIN TRANSACTION
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop foreign key constraint dbo.PIM_REGION_PIM_PROJCT_FK
PRINT N'Drop foreign key constraint dbo.PIM_REGION_PIM_PROJCT_FK'
GO
ALTER TABLE [dbo].[PIMS_PROJECT]
	DROP CONSTRAINT IF EXISTS [PIM_REGION_PIM_PROJCT_FK]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop index dbo.RESPCD_CODE_IDX
PRINT N'Drop index dbo.RESPCD_CODE_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_RESPONSIBILITY_CODE].[RESPCD_CODE_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop index dbo.CHRTAC_CODE_IDX
PRINT N'Drop index dbo.CHRTAC_CODE_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_CHART_OF_ACCOUNTS_CODE].[CHRTAC_CODE_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop index dbo.FINACT_CODE_IDX
PRINT N'Drop index dbo.FINACT_CODE_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_FINANCIAL_ACTIVITY_CODE].[FINACT_CODE_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop unique index dbo.PRODCT_CODE_IDX
PRINT N'Drop unique index dbo.PRODCT_CODE_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_PRODUCT].[PRODCT_CODE_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop index dbo.BIZFCN_CODE_IDX
PRINT N'Drop index dbo.BIZFCN_CODE_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_BUSINESS_FUNCTION_CODE].[BIZFCN_CODE_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop unique index dbo.ACQNOT_NOTE_ID_IDX
PRINT N'Drop unique index dbo.ACQNOT_NOTE_ID_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_ACQUISITION_FILE_NOTE].[ACQNOT_NOTE_ID_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop unique index dbo.PROJCT_CODE_IDX
PRINT N'Drop unique index dbo.PROJCT_CODE_IDX'
GO
DROP INDEX IF EXISTS [dbo].[PIMS_PROJECT].[PROJCT_CODE_IDX]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Drop unique constraint dbo.ACQNOT_ACQUISITION_FILE_NOTE_TUC
PRINT N'Drop unique constraint dbo.ACQNOT_ACQUISITION_FILE_NOTE_TUC'
GO
ALTER TABLE [dbo].[PIMS_ACQUISITION_FILE_NOTE]
	DROP CONSTRAINT IF EXISTS [ACQNOT_ACQUISITION_FILE_NOTE_TUC]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_BUSINESS_FUNCTION_CODE
PRINT N'Alter table dbo.PIMS_BUSINESS_FUNCTION_CODE'
GO
ALTER TABLE [dbo].[PIMS_BUSINESS_FUNCTION_CODE] DROP CONSTRAINT IF EXISTS [BIZFCN_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_COST_TYPE_CODE
PRINT N'Alter table dbo.PIMS_COST_TYPE_CODE'
GO
ALTER TABLE [dbo].[PIMS_COST_TYPE_CODE] DROP CONSTRAINT IF EXISTS [COSTYP_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_WORK_ACTIVITY_CODE
PRINT N'Alter table dbo.PIMS_WORK_ACTIVITY_CODE'
GO
ALTER TABLE [dbo].[PIMS_WORK_ACTIVITY_CODE] DROP CONSTRAINT IF EXISTS [WRKACT_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create unique constraint dbo.ACQNOT_NOTE_ID_TUC
PRINT N'Create unique constraint dbo.ACQNOT_NOTE_ID_TUC'
GO
ALTER TABLE [dbo].[PIMS_ACQUISITION_FILE_NOTE]
	ADD CONSTRAINT [ACQNOT_NOTE_ID_TUC]
	UNIQUE ([NOTE_ID]) 
	WITH (
		DATA_COMPRESSION = NONE
	) ON [PRIMARY]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create unique constraint dbo.ACQNOT_ACQUISITION_FILE_ID_TUC
PRINT N'Create unique constraint dbo.ACQNOT_ACQUISITION_FILE_ID_TUC'
GO
ALTER TABLE [dbo].[PIMS_ACQUISITION_FILE_NOTE]
	ADD CONSTRAINT [ACQNOT_ACQUISITION_FILE_ID_TUC]
	UNIQUE ([ACQUISITION_FILE_ID]) 
	WITH (
		DATA_COMPRESSION = NONE
	) ON [PRIMARY]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_FINANCIAL_ACTIVITY_CODE_HIST
PRINT N'Alter table dbo.PIMS_FINANCIAL_ACTIVITY_CODE_HIST'
GO
ALTER TABLE [dbo].[PIMS_FINANCIAL_ACTIVITY_CODE_HIST] ALTER COLUMN [CODE] smallint NOT NULL
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_CHART_OF_ACCOUNTS_CODE
PRINT N'Alter table dbo.PIMS_CHART_OF_ACCOUNTS_CODE'
GO
ALTER TABLE [dbo].[PIMS_CHART_OF_ACCOUNTS_CODE] DROP CONSTRAINT IF EXISTS [CHRTAC_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO
ALTER TABLE [dbo].[PIMS_CHART_OF_ACCOUNTS_CODE] ALTER COLUMN [CODE] int NOT NULL
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_FINANCIAL_ACTIVITY_CODE
PRINT N'Alter table dbo.PIMS_FINANCIAL_ACTIVITY_CODE'
GO
ALTER TABLE [dbo].[PIMS_FINANCIAL_ACTIVITY_CODE] DROP CONSTRAINT IF EXISTS [FINACT_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO
ALTER TABLE [dbo].[PIMS_FINANCIAL_ACTIVITY_CODE] ALTER COLUMN [CODE] smallint NOT NULL
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_RESPONSIBILITY_CODE_HIST
PRINT N'Alter table dbo.PIMS_RESPONSIBILITY_CODE_HIST'
GO
ALTER TABLE [dbo].[PIMS_RESPONSIBILITY_CODE_HIST] ALTER COLUMN [CODE] int NOT NULL
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_RESPONSIBILITY_CODE
PRINT N'Alter table dbo.PIMS_RESPONSIBILITY_CODE'
GO
ALTER TABLE [dbo].[PIMS_RESPONSIBILITY_CODE] DROP CONSTRAINT IF EXISTS [RESPCD_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO
ALTER TABLE [dbo].[PIMS_RESPONSIBILITY_CODE] ALTER COLUMN [CODE] int NOT NULL
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO
ALTER TABLE [dbo].[PIMS_RESPONSIBILITY_CODE] ADD CONSTRAINT [RESPCD_CODE_DEF] DEFAULT (NEXT VALUE FOR [PIMS_RESPONSIBILITY_CODE_SEQ]) FOR [CODE]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_YEARLY_FINANCIAL_CODE
PRINT N'Alter table dbo.PIMS_YEARLY_FINANCIAL_CODE'
GO
ALTER TABLE [dbo].[PIMS_YEARLY_FINANCIAL_CODE] DROP CONSTRAINT IF EXISTS [YRFINC_CODE_DEF]
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Alter table dbo.PIMS_CHART_OF_ACCOUNTS_CODE_HIST
PRINT N'Alter table dbo.PIMS_CHART_OF_ACCOUNTS_CODE_HIST'
GO
ALTER TABLE [dbo].[PIMS_CHART_OF_ACCOUNTS_CODE_HIST] ALTER COLUMN [CODE] int NOT NULL
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create index dbo.PROJCT_CODE_IDX
PRINT N'Create index dbo.PROJCT_CODE_IDX'
GO
CREATE NONCLUSTERED INDEX [PROJCT_CODE_IDX]
	ON [dbo].[PIMS_PROJECT]([CODE])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create index dbo.ACQNOT_NOTE_ID_IDX
PRINT N'Create index dbo.ACQNOT_NOTE_ID_IDX'
GO
CREATE NONCLUSTERED INDEX [ACQNOT_NOTE_ID_IDX]
	ON [dbo].[PIMS_ACQUISITION_FILE_NOTE]([NOTE_ID])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create unique index dbo.BIZFCN_CODE_IDX
PRINT N'Create unique index dbo.BIZFCN_CODE_IDX'
GO
CREATE UNIQUE NONCLUSTERED INDEX [BIZFCN_CODE_IDX]
	ON [dbo].[PIMS_BUSINESS_FUNCTION_CODE]([CODE])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create index dbo.PRODCT_CODE_IDX
PRINT N'Create index dbo.PRODCT_CODE_IDX'
GO
CREATE NONCLUSTERED INDEX [PRODCT_CODE_IDX]
	ON [dbo].[PIMS_PRODUCT]([CODE])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create index dbo.FINACT_CODE_IDX
PRINT N'Create index dbo.FINACT_CODE_IDX'
GO
CREATE NONCLUSTERED INDEX [FINACT_CODE_IDX]
	ON [dbo].[PIMS_FINANCIAL_ACTIVITY_CODE]([CODE])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create index dbo.CHRTAC_CODE_IDX
PRINT N'Create index dbo.CHRTAC_CODE_IDX'
GO
CREATE NONCLUSTERED INDEX [CHRTAC_CODE_IDX]
	ON [dbo].[PIMS_CHART_OF_ACCOUNTS_CODE]([CODE])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

-- Create index dbo.RESPCD_CODE_IDX
PRINT N'Create index dbo.RESPCD_CODE_IDX'
GO
CREATE NONCLUSTERED INDEX [RESPCD_CODE_IDX]
	ON [dbo].[PIMS_RESPONSIBILITY_CODE]([CODE])
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO

COMMIT TRANSACTION
GO
IF @@ERROR <> 0 SET NOEXEC ON
GO
DECLARE @Success AS BIT
SET @Success = 1
SET NOEXEC OFF
IF (@Success = 1) PRINT 'The database update succeeded'
ELSE BEGIN
   IF @@TRANCOUNT > 0 ROLLBACK TRANSACTION
   PRINT 'The database update failed'
END
GO
